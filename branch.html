
<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ØµÙØ­Ø© Ø§Ù„ÙØ±Ø¹</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
</head>
<body class="bg-gray-100 min-h-screen">
  <div class="max-w-4xl mx-auto p-4">
    <div class="flex justify-between items-center mb-4">
      <h2 id="welcome" class="text-xl font-bold text-gray-800">Ù…Ø±Ø­Ø¨Ø§Ù‹</h2>
      <button onclick="logout()" class="bg-red-600 text-white px-4 py-2 rounded">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
      <a href="my-debts.html" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">
        Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠÙ†
      </a>
      
    </div>

    <div class="bg-white p-6 rounded-lg shadow-md mb-6">
      <h3 class="text-lg font-semibold mb-4">Ø¥Ø¶Ø§ÙØ© Ø¯Ø®Ù„/Ù…ØµØ±ÙˆÙ</h3>
      <div class="grid gap-4 mb-4">
        <div>
          <label class="block text-sm">Ø§Ù„ÙˆØµÙ</label>
          <input id="desc" type="text" class="w-full px-3 py-2 border rounded" />
        </div>
        <div>
          <label class="block text-sm">Ø§Ù„Ù‚ÙŠÙ…Ø© (Ø¯ÙŠÙ†Ø§Ø±)</label>
          <input id="amount" type="number" step="0.001" class="w-full px-3 py-2 border rounded" />
        </div>
        <div>
          <label class="block text-sm">Ø§Ù„Ù†ÙˆØ¹</label>
          <select id="type" class="w-full px-3 py-2 border rounded">
            <option value="Ø¯Ø®Ù„">Ø¯Ø®Ù„</option>
            <option value="Ù…ØµØ±ÙˆÙ">Ù…ØµØ±ÙˆÙ</option>
          </select>
        </div>
        <button onclick="addEntry()" class="w-full bg-green-600 text-white py-2 rounded">Ø¥Ø¶Ø§ÙØ©</button>
      </div>
    </div>

    <div class="bg-white p-6 rounded-lg shadow-md mb-6">
      <button onclick="toggleDebtForm()" class="bg-yellow-500 text-white px-4 py-2 rounded mb-4">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©</button>
      <div id="debtForm" class="grid gap-4 mb-4 hidden">
        <div>
          <label class="block text-sm">Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†</label>
          <input id="debtorName" type="text" class="w-full px-3 py-2 border rounded" />
        </div>
        <div>
          <label class="block text-sm">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
          <input id="debtorPhone" type="text" class="w-full px-3 py-2 border rounded" />
        </div>
        <div>
          <label class="block text-sm">Ø§Ù„Ù…Ø¨Ù„Øº (Ø¯ÙŠÙ†Ø§Ø±)</label>
          <input id="debtorAmount" type="number" step="0.001" class="w-full px-3 py-2 border rounded" />
        </div>
        <div>
          <label class="block text-sm">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
          <input id="debtorNotes" type="text" class="w-full px-3 py-2 border rounded" />
        </div>
        <button onclick="addDebt()" class="w-full bg-blue-600 text-white py-2 rounded">Ø­ÙØ¸ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©</button>
      </div>
    </div>

    <div class="overflow-x-auto bg-white p-4 rounded-lg shadow-md">
      <table class="min-w-full text-sm text-center">
        <thead class="bg-gray-200">
          <tr>
            <th>Ø§Ù„Ù…ÙˆØ¸Ù</th>
            <th>Ø§Ù„ÙØ±Ø¹</th>
            <th>Ø§Ù„ÙˆØµÙ</th>
            <th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th>
            <th>Ø§Ù„Ù†ÙˆØ¹</th>
            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
          </tr>
        </thead>
        <tbody id="dataBody"></tbody>
      </table>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyB12tfYkdfVq6xJWyG3aHJkMjQbRgBCCqk",
      authDomain: "limeted-74dd8.firebaseapp.com",
      databaseURL: "https://limeted-74dd8-default-rtdb.firebaseio.com",
      projectId: "limeted-74dd8",
      storageBucket: "limeted-74dd8.appspot.com",
      messagingSenderId: "822523906481",
      appId: "1:822523906481:web:a8673641b56dfd95711590"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    let currentUserData = { name: "", branch: "" };

    firebase.auth().onAuthStateChanged(user => {
      if (user) {
        db.ref("users/" + user.uid).once("value").then(snapshot => {
          const data = snapshot.val();
          currentUserData = data;
          document.getElementById("welcome").innerText = "Ù…Ø±Ø­Ø¨Ø§Ù‹ " + data.name + " - ÙØ±Ø¹ " + data.branch;
          loadEntries(user.uid);
        });
      } else {
        window.location.href = "index.html";
      }
    });

    function logout() {
      auth.signOut().then(() => window.location.href = "index.html");
    }

    function addEntry() {
    const desc = document.getElementById("desc").value;
    const amount = document.getElementById("amount").value;
    const type = document.getElementById("type").value;
    const now = new Date();
    const timestamp = now.toISOString(); // âœ… ØµÙŠØºØ© ØµØ­ÙŠØ­Ø© ÙˆØ¢Ù…Ù†Ø©

    if (!desc || !amount) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒØ§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

    db.ref("branches/" + auth.currentUser.uid).push({
      desc,
      amount,
      type,
      timestamp,
      employeeName: currentUserData.name,
      branchName: currentUserData.branch
    });

    document.getElementById("desc").value = "";
    document.getElementById("amount").value = "";
  }

    function loadEntries(uid) {
      db.ref("branches/" + uid).on("value", snapshot => {
        const tbody = document.getElementById("dataBody");
        tbody.innerHTML = "";
        snapshot.forEach(entry => {
          const data = entry.val();
          const tr = `<tr class='border-t'>
            <td>${data.employeeName}</td>
            <td>${data.branchName}</td>
            <td>${data.desc}</td>
            <td>${data.amount}</td>
            <td>${data.type}</td>
            <td>${new Date(data.timestamp).toLocaleString()}</td>
          </tr>`;
          tbody.innerHTML += tr;
        });
      });
    }

    function toggleDebtForm() {
      document.getElementById("debtForm").classList.toggle("hidden");
    }

    function addDebt() {
  const name = document.getElementById("debtorName").value;
  const phone = document.getElementById("debtorPhone").value;
  const amount = document.getElementById("debtorAmount").value;
  const notes = document.getElementById("debtorNotes").value;

  if (!name || !phone || !amount) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù‡Ø§ØªÙ ÙˆØ§Ù„Ù…Ø¨Ù„Øº");

  const uid = firebase.auth().currentUser.uid;

  db.ref("debts").push({
    name,
    phone,
    amount: parseFloat(amount),
    notes,
    branch: currentUserData.branch,
    employee: currentUserData.name, // ğŸ‘ˆ Ù…Ù‡Ù… Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¯ÙŠÙˆÙ† ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ù…ÙˆØ¸Ù
    uid,                            // ğŸ‘ˆ Ù…Ù‡Ù… Ø¬Ø¯Ù‹Ø§ Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ø§Ù„Ùƒ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©
    paid: 0,                        // ğŸ‘ˆ Ù…Ø¨Ø¯Ø¦ÙŠÙ‹Ø§ Ø§Ù„Ù…Ø¯ÙÙˆØ¹ ØµÙØ±
    createdAt: new Date().toISOString()
  });

  document.getElementById("debtorName").value = "";
  document.getElementById("debtorPhone").value = "";
  document.getElementById("debtorAmount").value = "";
  document.getElementById("debtorNotes").value = "";
  document.getElementById("debtForm").classList.add("hidden");
  alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­");
}

  </script>
</body>
</html>
